# Web ç®¡ç†åå° - å¿«é€Ÿå…¥é—¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ 1 æ­¥ï¼šå¯åŠ¨æœåŠ¡å™¨

#### æ–¹å¼ 1ï¼šGo ç›´æ¥è¿è¡Œ
```bash
cd webtoapp-key-server
go run main.go
```

#### æ–¹å¼ 2ï¼šDocker è¿è¡Œï¼ˆå¦‚æœæœ‰ Dockerfileï¼‰
```bash
docker build -t webtoapp-key-server .
docker run -p 8080:8080 webtoapp-key-server
```

### ç¬¬ 2 æ­¥ï¼šè®¿é—®ç®¡ç†åå°

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
```
http://localhost:8080/login.html
```

### ç¬¬ 3 æ­¥ï¼šç”Ÿæˆ API Keyï¼ˆé¦–æ¬¡ç™»å½•å‰ï¼‰

åœ¨æœåŠ¡å™¨å¯åŠ¨åï¼Œè¿è¡Œåˆå§‹åŒ–è„šæœ¬ç”Ÿæˆç®¡ç†å‘˜ API Keyï¼š

```bash
# ä½¿ç”¨ curl åˆ›å»ºç¬¬ä¸€ä¸ª API Key
curl -X POST http://localhost:8080/api/admin/api-keys \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Admin API Key",
    "permissions": ["read:statistics", "write:keys", "read:logs", "write:config"]
  }'
```

**æ³¨æ„**ï¼šå½“å‰ç³»ç»Ÿè¿˜æ²¡æœ‰å®ç°å¼•å¯¼ç¨‹åºï¼Œéœ€è¦å…ˆé€šè¿‡ç›´æ¥çš„ HTTP è¯·æ±‚åˆ›å»ºç¬¬ä¸€ä¸ª API Keyã€‚

### ç¬¬ 4 æ­¥ï¼šç™»å½•ç®¡ç†åå°

1. å¤åˆ¶ä¸Šä¸€æ­¥è·å¾—çš„ `full_key`
2. åœ¨ç™»å½•é¡µé¢çš„ "API Key" å­—æ®µä¸­ç²˜è´´
3. ç‚¹å‡» "ç™»å½•" æŒ‰é’®

## ğŸ“Š åŠŸèƒ½æ¼”ç¤º

### ğŸ”‘ API Key ç®¡ç†
- **æ–°å»º Key**ï¼šç‚¹å‡» "+ ç”Ÿæˆæ–° Key" æŒ‰é’®
  - è¾“å…¥åç§°ï¼ˆå¦‚ "Mobile App"ï¼‰
  - é€‰æ‹©æƒé™ï¼ˆè¯»å–ç»Ÿè®¡ã€ç®¡ç†å¯†é’¥ç­‰ï¼‰
  - å®Œæˆåå¤åˆ¶å¹¶ä¿å­˜ Key
  
- **åˆ—è¡¨ç®¡ç†**ï¼šæŸ¥çœ‹æ‰€æœ‰å·²åˆ›å»ºçš„ API Key
  - Key å‰ç¼€ï¼ˆç”¨äºè¯†åˆ«ï¼‰
  - å½“å‰çŠ¶æ€ï¼ˆæ´»è·ƒ/åœç”¨/å·²æ’¤é”€ï¼‰
  - æœ€åä½¿ç”¨æ—¶é—´
  
- **æ’¤é”€ Key**ï¼šç‚¹å‡»è¡Œå°¾çš„ "æ’¤é”€" æŒ‰é’®ï¼Œç¡®è®¤åä½¿ Key å¤±æ•ˆ

### ğŸ“ˆ ç»Ÿè®¡åˆ†æ
- **ä»ªè¡¨æ¿**ï¼šä¸€è§ˆåº”ç”¨å…³é”®æŒ‡æ ‡
  - API Key æ€»æ•°ã€æ´»è·ƒæ•°ã€å·²æ’¤é”€æ•°
  - æ€»æ¿€æ´»æ•°ã€éªŒè¯æˆåŠŸæ•°ã€è®¾å¤‡æ•°
  - è¿‘ 7 å¤©æ¿€æ´»è¶‹åŠ¿å›¾è¡¨
  - æ’åå‰ 5 çš„åº”ç”¨
  
- **ç»Ÿè®¡åˆ†æ**ï¼šæ·±å…¥æ•°æ®åˆ†æ
  - æŒ‰åº”ç”¨ç­›é€‰
  - æŒ‰æ—¶é—´æ®µç­›é€‰ï¼ˆ7/30/90 å¤©ï¼‰
  - å¤šç§å›¾è¡¨å±•ç¤ºï¼ˆæŸ±çŠ¶å›¾ã€é¥¼å›¾ã€æŠ˜çº¿å›¾ï¼‰
  - å¯¼å‡º CSV æ•°æ®

### ğŸ“ å®¡è®¡æ—¥å¿—
- æŸ¥çœ‹æ‰€æœ‰ API Key çš„ä½¿ç”¨è®°å½•
- æŒ‰å…³é”®è¯æœç´¢
- æŒ‰æ“ä½œç±»å‹ç­›é€‰
- æŸ¥çœ‹æ“ä½œçš„ IP åœ°å€å’Œæ—¶é—´æˆ³

### âš™ï¸ ç³»ç»Ÿè®¾ç½®
- æŸ¥çœ‹å’Œç®¡ç†å½“å‰ API Key
- é…ç½®æ—¥å¿—å’Œç›‘æ§è®¾ç½®
- é‡ç½® API Keyï¼ˆè°¨æ…æ“ä½œï¼‰

## ğŸ” å®‰å…¨æœ€ä½³å®è·µ

### âœ… åŠ¡å¿…æ‰§è¡Œ
1. **ä¿æŠ¤æ‚¨çš„ API Key**
   ```
   âš ï¸ ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç  API Key
   âš ï¸ ä¸è¦å°† Key åˆ†äº«ç»™ä»–äºº
   âš ï¸ ä¸è¦åœ¨å…¬å¼€åœºåˆæš´éœ² Key
   ```

2. **å®šæœŸè½®æ¢ Key**
   - æ¯æœˆè‡³å°‘æ£€æŸ¥ä¸€æ¬¡ Key çš„ä½¿ç”¨æƒ…å†µ
   - æ’¤é”€é•¿æœŸæœªä½¿ç”¨çš„ Key
   - ä¸ºä¸åŒçš„åº”ç”¨ä½¿ç”¨ä¸åŒçš„ Key

3. **ç›‘æ§å®¡è®¡æ—¥å¿—**
   - å®šæœŸæŸ¥çœ‹æ“ä½œæ—¥å¿—
   - æ³¨æ„å¼‚å¸¸çš„è®¿é—®æ¨¡å¼
   - åŠæ—¶å“åº”å®‰å…¨å‘Šè­¦

4. **å¯ç”¨ HTTPS**
   ```bash
   # åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¿…é¡»ä½¿ç”¨ HTTPS
   # ä¿®æ”¹ main.go ä½¿ç”¨ TLS è¯ä¹¦
   router.RunTLS(":443", "cert.pem", "key.pem")
   ```

## ğŸ“š å¸¸ç”¨ API è°ƒç”¨ç¤ºä¾‹

### ç”Ÿæˆ API Key
```bash
curl -X POST http://localhost:8080/api/admin/api-keys \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Production API",
    "permissions": ["read:statistics"]
  }'
```

### åˆ—å‡º API Key
```bash
curl http://localhost:8080/api/admin/api-keys \
  -H "Authorization: Bearer YOUR_API_KEY"
```

### è·å–ç»Ÿè®¡æ•°æ®
```bash
curl http://localhost:8080/api/admin/statistics \
  -H "Authorization: Bearer YOUR_API_KEY"
```

### è·å–åº”ç”¨è¶‹åŠ¿
```bash
curl "http://localhost:8080/api/admin/statistics/apps/com.example.app/trends?days=30" \
  -H "Authorization: Bearer YOUR_API_KEY"
```

## ğŸ› ï¸ æ•°æ®åº“åˆå§‹åŒ–

å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œç¡®ä¿æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬ï¼š

```go
import "github.com/yingcaihuang/webtoapp-key-server/internal/database"

// åœ¨ main.go ä¸­çš„åˆå§‹åŒ–ä»£ç 
if err := database.InitDatabase(db); err != nil {
    log.Fatal(err)
}
```

## ğŸ“± å‰ç«¯ç›®å½•ç»“æ„

```
web/
â”œâ”€â”€ index.html          # ä¸»ç®¡ç†ç•Œé¢
â”œâ”€â”€ login.html          # ç™»å½•é¡µé¢
â”œâ”€â”€ css/
â”‚   â””â”€â”€ style.css       # æ ·å¼è¡¨ï¼ˆåŒ…å«å“åº”å¼è®¾è®¡ï¼‰
â””â”€â”€ js/
    â””â”€â”€ app.js          # å‰ç«¯é€»è¾‘ï¼ˆä¸åç«¯ API äº¤äº’ï¼‰
```

## ğŸŒ æµè§ˆå™¨å…¼å®¹æ€§

- Chrome / Edgeï¼šâœ… å®Œå…¨æ”¯æŒ
- Firefoxï¼šâœ… å®Œå…¨æ”¯æŒ
- Safariï¼šâœ… å®Œå…¨æ”¯æŒ
- IE 11ï¼šâŒ ä¸æ”¯æŒ

## ğŸ“Š æ•°æ®åº“è¡¨è¯´æ˜

### api_keys è¡¨
å­˜å‚¨æ‰€æœ‰ç”Ÿæˆçš„ API Key

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | uint | ä¸»é”® |
| name | string | Key åç§° |
| key_hash | string | Key å“ˆå¸Œå€¼ï¼ˆç”¨äºéªŒè¯ï¼‰ |
| key_prefix | string | å¯†é’¥å‰ç¼€ï¼ˆæ˜¾ç¤ºç”¨ï¼‰ |
| secret | string | å¯†é’¥ |
| status | string | çŠ¶æ€ï¼šactive/inactive/revoked |
| permission | string | æƒé™ï¼ˆé€—å·åˆ†éš”ï¼‰ |
| last_used | timestamp | æœ€åä½¿ç”¨æ—¶é—´ |
| created_at | timestamp | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | æ›´æ–°æ—¶é—´ |

### statistics è¡¨
å­˜å‚¨åº”ç”¨çš„ç»Ÿè®¡æ•°æ®

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | uint | ä¸»é”® |
| app_id | string | åº”ç”¨ ID |
| total_activations | int64 | æ€»æ¿€æ´»æ•° |
| successful_verifications | int64 | éªŒè¯æˆåŠŸæ•° |
| failed_verifications | int64 | éªŒè¯å¤±è´¥æ•° |
| total_devices | int64 | è®¾å¤‡æ•° |
| active_codes | int64 | æ´»è·ƒæ¿€æ´»ç  |
| revoked_codes | int64 | å·²æ’¤é”€æ¿€æ´»ç  |

### daily_stats è¡¨
å­˜å‚¨æ¯æ—¥ç»Ÿè®¡æ•°æ®

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | uint | ä¸»é”® |
| app_id | string | åº”ç”¨ ID |
| date | date | æ—¥æœŸ |
| verification_count | int | éªŒè¯æ¬¡æ•° |
| success_count | int | æˆåŠŸæ¬¡æ•° |
| failure_count | int | å¤±è´¥æ¬¡æ•° |
| new_devices | int | æ–°è®¾å¤‡æ•° |
| codes_generated | int | ç”Ÿæˆæ¿€æ´»ç æ•° |
| codes_revoked | int | æ’¤é”€æ¿€æ´»ç æ•° |

### admin_audit_logs è¡¨
å­˜å‚¨ç®¡ç†å‘˜æ“ä½œæ—¥å¿—

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | uint | ä¸»é”® |
| admin_id | uint | ç®¡ç†å‘˜ IDï¼ˆAPI Key IDï¼‰ |
| action | string | æ“ä½œç±»å‹ |
| resource | string | æ“ä½œèµ„æº |
| details | string | æ“ä½œè¯¦æƒ… |
| status | string | æ“ä½œçŠ¶æ€ |
| ip_address | string | æ“ä½œçš„ IP åœ°å€ |
| timestamp | timestamp | æ“ä½œæ—¶é—´ |

## ğŸ› å¸¸è§é—®é¢˜è§£å†³

### Q1: å¦‚ä½•é‡ç½®å¿˜è®°çš„ API Keyï¼Ÿ
**A:** ä½¿ç”¨æ•°æ®åº“ç®¡ç†å·¥å…·ç›´æ¥ä¿®æ”¹æˆ–åˆ é™¤ç›¸åº”çš„è®°å½•ï¼Œç„¶åé‡æ–°ç”Ÿæˆã€‚

### Q2: API Key æœ‰è¿‡æœŸæ—¶é—´å—ï¼Ÿ
**A:** å½“å‰å®ç°æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä½†æ‚¨å¯ä»¥æ‰‹åŠ¨æ’¤é”€ã€‚

### Q3: æ”¯æŒå¤šç”¨æˆ·ç®¡ç†å—ï¼Ÿ
**A:** å½“å‰ç‰ˆæœ¬ä»¥ API Key ä¸ºåŸºç¡€ï¼Œæ”¯æŒå¤šä¸ª Keyï¼Œæ¯ä¸ª Key æœ‰ç‹¬ç«‹çš„æƒé™é…ç½®ã€‚

### Q4: æ•°æ®å¯ä»¥å¯¼å‡ºå—ï¼Ÿ
**A:** æ”¯æŒ CSV å¯¼å‡ºç»Ÿè®¡æ•°æ®ï¼Œå¯åœ¨ç»Ÿè®¡åˆ†æé¡µé¢ç‚¹å‡» "å¯¼å‡º CSV" æŒ‰é’®ã€‚

## ğŸ“ è·å–å¸®åŠ©

1. æŸ¥çœ‹å®Œæ•´æ–‡æ¡£ï¼š`WEB_ADMIN_README.md`
2. æŸ¥çœ‹ API æµ‹è¯•è„šæœ¬ï¼š`test_api.sh`ã€`test_api.py`
3. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—è·å–é”™è¯¯ä¿¡æ¯
4. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰æŸ¥çœ‹å®¢æˆ·ç«¯é”™è¯¯

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-01-02)
- âœ¨ å®Œæˆ Web ç®¡ç†åå°åŸºç¡€åŠŸèƒ½
- âœ¨ API Key è®¤è¯å’Œæƒé™ç®¡ç†
- âœ¨ ç»Ÿè®¡åˆ†æå’Œæ•°æ®å¯è§†åŒ–
- âœ¨ å®¡è®¡æ—¥å¿—è®°å½•
- âœ¨ å“åº”å¼å‰ç«¯ç•Œé¢

---

**ä¸‹ä¸€æ­¥**ï¼šæ ¹æ®æ‚¨çš„éœ€æ±‚å®šåˆ¶æƒé™ç³»ç»Ÿã€æ·»åŠ ç”¨æˆ·ç®¡ç†æˆ–é›†æˆæ›´å¤šçš„ç»Ÿè®¡æŒ‡æ ‡ã€‚
